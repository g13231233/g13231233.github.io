<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>物资搜刮者 - 完整版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #ecf0f1;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
        }
        
        .header h1 {
            font-size: 42px;
            background: linear-gradient(to right, #f39c12, #e74c3c, #9b59b6, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .header p {
            color: #bdc3c7;
            font-size: 18px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            background: rgba(25, 35, 60, 0.85);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            margin-top: 10px;
        }
        
        .sidebar {
            width: 250px;
            background: rgba(20, 30, 48, 0.95);
            padding: 20px 0;
            border-right: 1px solid #34495e;
            display: flex;
            flex-direction: column;
        }
        
        .logo {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #34495e;
        }
        
        .logo h2 {
            font-size: 24px;
            color: #f39c12;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .menu {
            list-style: none;
            padding: 0 15px;
            flex-grow: 1;
        }
        
        .menu li {
            margin-bottom: 10px;
        }
        
        .menu button {
            width: 100%;
            padding: 15px;
            background: rgba(44, 62, 80, 0.7);
            border: none;
            border-radius: 8px;
            color: #ecf0f1;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .menu button i {
            margin-right: 12px;
            font-size: 20px;
        }
        
        .menu button:hover {
            background: rgba(52, 152, 219, 0.8);
            transform: translateX(5px);
        }
        
        .menu button.active {
            background: #3498db;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
        }
        
        .menu button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
        }
        
        .menu button:hover::after {
            transform: translateX(100%);
            transition: transform 0.6s ease;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(30, 40, 60, 0.9);
            padding: 15px 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
            min-width: 120px;
            margin: 5px 0;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #f39c12;
            margin-top: 5px;
        }
        
        .panel {
            flex: 1;
            background: rgba(30, 40, 60, 0.9);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            display: none;
            overflow: auto;
        }
        
        .panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel-title {
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
            color: #3498db;
            display: flex;
            align-items: center;
        }
        
        .panel-title i {
            margin-right: 10px;
        }
        
        .scavenge-area {
            text-align: center;
        }
        
        .scavenge-btn {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 22px;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .scavenge-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 7px 20px rgba(231, 76, 60, 0.6);
        }
        
        .scavenge-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress-container {
            width: 100%;
            height: 30px;
            background: rgba(52, 73, 94, 0.7);
            border-radius: 15px;
            margin: 25px 0;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 15px;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            z-index: 10;
            width: 100%;
            text-align: center;
        }
        
        .auto-scavenge {
            background: rgba(46, 204, 113, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 25px;
            border: 1px solid #2ecc71;
        }
        
        .auto-scavenge button {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s ease;
        }
        
        .auto-scavenge button:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .item-card {
            background: rgba(40, 50, 70, 0.8);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .item-name {
            font-weight: 600;
            margin: 10px 0;
            font-size: 18px;
        }
        
        .item-rarity {
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .item-quantity {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.6);
            color: white;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 14px;
        }
        
        .item-price {
            color: #f39c12;
            font-weight: 700;
            font-size: 18px;
            margin: 5px 0;
        }
        
        .sell-btn {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .sell-btn:hover {
            background: linear-gradient(to right, #c0392b, #a52714);
        }
        
        .skill-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .skill-item {
            background: rgba(40, 50, 70, 0.8);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .skill-name {
            font-size: 20px;
            font-weight: 600;
        }
        
        .skill-level {
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
        }
        
        .skill-desc {
            color: #bdc3c7;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .skill-progress {
            height: 10px;
            background: #34495e;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .skill-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .skill-cost {
            color: #f39c12;
            font-weight: 700;
            margin: 10px 0;
            font-size: 18px;
        }
        
        .upgrade-btn {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            font-size: 16px;
            transition: all 0.2s ease;
        }
        
        .upgrade-btn:hover {
            background: linear-gradient(to right, #27ae60, #219653);
            transform: translateY(-2px);
        }
        
        .upgrade-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
        }
        
        .reset-section {
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .reset-warning {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            border-radius: 10px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .reset-btn {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 20px;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            background: linear-gradient(to right, #c0392b, #a52714);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        .guide-content {
            line-height: 1.8;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .guide-section {
            margin-bottom: 25px;
            background: rgba(40, 50, 70, 0.5);
            padding: 15px;
            border-radius: 10px;
        }
        
        .guide-section h3 {
            color: #3498db;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .guide-section h3 i {
            margin-right: 10px;
        }
        
        .guide-section p {
            margin-bottom: 8px;
        }
        
        .guide-section ul {
            padding-left: 25px;
            margin-top: 10px;
        }
        
        .guide-section li {
            margin-bottom: 8px;
        }
        
        .rarity-0 { color: #95a5a6; } /* 普通 - 灰色 */
        .rarity-1 { color: #2ecc71; } /* 优秀 - 绿色 */
        .rarity-2 { color: #3498db; } /* 精良 - 蓝色 */
        .rarity-3 { color: #9b59b6; } /* 史诗 - 紫色 */
        .rarity-4 { color: #e74c3c; } /* 传奇 - 红色 */
        .rarity-5 { /* 神话 - 彩虹色 */
            background: linear-gradient(to right, #ff0000, #ff9900, #ffff00, #00ff00, #00ffff, #0000ff, #9900ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            text-shadow: 0 0 5px rgba(255,255,255,0.3);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background: rgba(25, 35, 45, 0.95);
            border-left: 5px solid #2ecc71;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateX(200%);
            transition: transform 0.4s ease;
            z-index: 1000;
            max-width: 350px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            border-left-color: #e74c3c;
        }
        
        .notification-content {
            display: flex;
            align-items: center;
        }
        
        .notification i {
            font-size: 24px;
            margin-right: 15px;
        }
        
        /* 离线收益弹窗 */
        .offline-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .offline-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .offline-content {
            background: linear-gradient(135deg, #2c3e50, #1a2a6c);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #3498db;
            position: relative;
        }
        
        .offline-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .offline-header h2 {
            font-size: 28px;
            color: #f39c12;
            margin-bottom: 10px;
        }
        
        .offline-stats {
            display: flex;
            justify-content: space-around;
            background: rgba(30, 40, 60, 0.8);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .offline-stat {
            text-align: center;
        }
        
        .offline-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2ecc71;
        }
        
        .offline-items {
            margin-top: 20px;
        }
        
        .offline-items h3 {
            color: #3498db;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #34495e;
        }
        
        .offline-item-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }
        
        .offline-item {
            background: rgba(40, 50, 70, 0.8);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            position: relative;
        }
        
        .close-offline {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #34495e;
            }
            
            .stats-bar {
                flex-direction: column;
                align-items: center;
            }
            
            .stat-item {
                margin: 10px 0;
            }
            
            .offline-stat {
                margin: 0 5px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>物资搜刮者</h1>
        <p>搜刮稀有物资，升级你的技能，成为最富有的搜刮者！</p>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <h2><i class="fas fa-treasure-chest"></i> 搜刮行动</h2>
            </div>
            <ul class="menu">
                <li>
                    <button id="scavengeBtn" class="active">
                        <i class="fas fa-search"></i> 搜刮物资
                    </button>
                </li>
                <li>
                    <button id="inventoryBtn">
                        <i class="fas fa-shopping-bag"></i> 物资背包
                    </button>
                </li>
                <li>
                    <button id="skillsBtn">
                        <i class="fas fa-trophy"></i> 技能升级
                    </button>
                </li>
                <li>
                    <button id="guideBtn">
                        <i class="fas fa-book"></i> 游戏说明
                    </button>
                </li>
                <li>
                    <button id="resetBtn">
                        <i class="fas fa-redo"></i> 重置游戏
                    </button>
                </li>
            </ul>
            
            <div class="logo" style="margin-top: auto; border-top: 1px solid #34495e; border-bottom: none;">
                <p>当前版本: 3.2</p>
                <p>优化倒计时显示</p>
            </div>
        </div>
        
        <div class="main-content">
            <div class="stats-bar">
                <div class="stat-item">
                    <div><i class="fas fa-coins"></i> 金币</div>
                    <div class="stat-value" id="gold">0</div>
                </div>
                <div class="stat-item">
                    <div><i class="fas fa-sync-alt"></i> 搜刮次数</div>
                    <div class="stat-value" id="scavengeCount">0</div>
                </div>
                <div class="stat-item">
                    <div><i class="fas fa-box-open"></i> 物品数量</div>
                    <div class="stat-value" id="itemCount">0</div>
                </div>
                <div class="stat-item">
                    <div><i class="fas fa-robot"></i> 自动搜刮</div>
                    <div class="stat-value" id="autoStatus">关闭</div>
                </div>
            </div>
            
            <!-- 搜刮面板 -->
            <div id="scavengePanel" class="panel active">
                <h2 class="panel-title"><i class="fas fa-search"></i> 物资搜刮</h2>
                <div class="scavenge-area">
                    <p>点击按钮开始搜刮物资，每次搜刮需要一定时间</p>
                    <p>物资稀有度越高，价值越大！</p>
                    
                    <button id="startScavenge" class="scavenge-btn">
                        <i class="fas fa-play"></i> 开始搜刮
                    </button>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="scavengeProgress"></div>
                        <div class="progress-text" id="progressText">正在寻找可搜刮地点···</div>
                    </div>
                    
                    <div class="auto-scavenge" id="autoSection" style="display: none;">
                        <h3><i class="fas fa-robot"></i> 自动搜刮功能已解锁!</h3>
                        <p>开启后系统将自动为你搜刮物资（即使关闭页面也会继续）</p>
                        <button id="toggleAuto"><i class="fas fa-power-off"></i> 开启自动搜刮</button>
                    </div>
                </div>
            </div>
            
            <!-- 背包面板 -->
            <div id="inventoryPanel" class="panel">
                <h2 class="panel-title"><i class="fas fa-backpack"></i> 物资背包</h2>
                <div class="inventory-grid" id="inventoryGrid">
                    <!-- 物品将通过JS动态添加 -->
                </div>
            </div>
            
            <!-- 技能面板 -->
            <div id="skillsPanel" class="panel">
                <h2 class="panel-title"><i class="fas fa-trophy"></i> 技能升级</h2>
                <div class="skill-list">
                    <div class="skill-item">
                        <div class="skill-header">
                            <div class="skill-name"><i class="fas fa-cubes"></i> 物资数量</div>
                            <div class="skill-level">等级: <span id="quantityLevel">0</span>/30</div>
                        </div>
                        <div class="skill-desc">
                            提升每次搜刮获得的物资数量范围。每升一级增加最大数量+1（如等级1:1-2个，等级2:1-3个）
                        </div>
                        <div class="skill-progress">
                            <div class="skill-progress-bar" id="quantityProgress" style="width: 0%"></div>
                        </div>
                        <div class="skill-cost">
                            升级所需金币: <span id="quantityCost">100</span>
                        </div>
                        <button class="upgrade-btn" id="upgradeQuantity">
                            <i class="fas fa-arrow-up"></i> 升级技能
                        </button>
                    </div>
                    
                    <div class="skill-item">
                        <div class="skill-header">
                            <div class="skill-name"><i class="fas fa-star"></i> 稀有概率</div>
                            <div class="skill-level">等级: <span id="rarityLevel">0</span>/30</div>
                        </div>
                        <div class="skill-desc">
                            提高获得稀有物品的概率。每升一级提升0.5%概率。
                        </div>
                        <div class="skill-progress">
                            <div class="skill-progress-bar" id="rarityProgress" style="width: 0%"></div>
                        </div>
                        <div class="skill-cost">
                            升级所需金币: <span id="rarityCost">100</span>
                        </div>
                        <button class="upgrade-btn" id="upgradeRarity">
                            <i class="fas fa-arrow-up"></i> 升级技能
                        </button>
                    </div>
                    
                    <div class="skill-item">
                        <div class="skill-header">
                            <div class="skill-name"><i class="fas fa-bolt"></i> 搜刮效率</div>
                            <div class="skill-level">等级: <span id="speedLevel">0</span>/30</div>
                        </div>
                        <div class="skill-desc">
                            减少每次搜刮所需时间。每升一级减少0.5秒。
                        </div>
                        <div class="skill-progress">
                            <div class="skill-progress-bar" id="speedProgress" style="width: 0%"></div>
                        </div>
                        <div class="skill-cost">
                            升级所需金币: <span id="speedCost">100</span>
                        </div>
                        <button class="upgrade-btn" id="upgradeSpeed">
                            <i class="fas fa-arrow-up"></i> 升级技能
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 游戏说明面板 -->
            <div id="guidePanel" class="panel">
                <h2 class="panel-title"><i class="fas fa-book"></i> 游戏说明</h2>
                <div class="guide-content">
                    <div class="guide-section">
                        <h3><i class="fas fa-info-circle"></i> 游戏介绍</h3>
                        <p>欢迎来到《物资搜刮者》！在这个游戏中，你将扮演一名搜刮者，在废墟中寻找有价值的物资。通过搜刮物资、出售物品、升级技能，成为最富有的搜刮者！</p>
                    </div>
                    
                    <div class="guide-section">
                        <h3><i class="fas fa-gamepad"></i> 核心玩法</h3>
                        <ul>
                            <li><strong>搜刮物资</strong>：点击"搜刮物资"按钮开始搜刮，进度条满后获得物资</li>
                            <li><strong>物资稀有度</strong>：物资分为6种稀有度，从普通到神话级</li>
                            <li><strong>背包系统</strong>：查看所有搜刮到的物资，可随时出售</li>
                            <li><strong>物资堆叠</strong>：相同类型的物资会自动堆叠，显示数量</li>
                            <li><strong>市场价格波动</strong>：物资价格每5分钟变化一次</li>
                        </ul>
                    </div>
                    
                    <div class="guide-section">
                        <h3><i class="fas fa-cogs"></i> 技能系统</h3>
                        <ul>
                            <li><strong>物资数量</strong>：提升每次搜刮获得的物资数量范围（每级+1最大数量）</li>
                            <li><strong>稀有概率</strong>：提高获得稀有物品的概率（每级+0.5%）</li>
                            <li><strong>搜刮效率</strong>：减少每次搜刮所需时间（每级-0.5秒）</li>
                            <li><strong>升级规则</strong>：每级所需金币翻倍，最高30级</li>
                        </ul>
                    </div>
                    
                    <div class="guide-section">
                        <h3><i class="fas fa-robot"></i> 自动搜刮</h3>
                        <p>手动搜刮10次后解锁自动搜刮功能：</p>
                        <ul>
                            <li>开启后系统会自动为你搜刮物资</li>
                            <li>即使关闭页面也会在后台继续搜刮</li>
                            <li>下次打开页面时会计算离线期间获得的物资</li>
                        </ul>
                    </div>
                    
                    <div class="guide-section">
                        <h3><i class="fas fa-shopping-cart"></i> 背包与出售</h3>
                        <ul>
                            <li>背包中显示所有搜刮到的物资</li>
                            <li>相同物资会自动堆叠，显示数量</li>
                            <li>点击"出售"按钮出售物资获得金币</li>
                            <li>物资价格会随着市场波动而变化</li>
                            <li>稀有度越高的物资价值越高</li>
                        </ul>
                    </div>
                    
                    <div class="guide-section">
                        <h3><i class="fas fa-trophy"></i> 稀有度系统</h3>
                        <ul>
                            <li><span class="rarity-0">普通（灰色）</span>：最常见，价值最低</li>
                            <li><span class="rarity-1">优秀（绿色）</span>：较常见</li>
                            <li><span class="rarity-2">精良（蓝色）</span>：有一定价值</li>
                            <li><span class="rarity-3">史诗（紫色）</span>：比较稀有</li>
                            <li><span class="rarity-4">传奇（红色）</span>：非常稀有</li>
                            <li><span class="rarity-5">神话（彩虹色）</span>：极其稀有，价值极高</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- 重置面板 -->
            <div id="resetPanel" class="panel">
                <h2 class="panel-title"><i class="fas fa-redo"></i> 重置游戏</h2>
                <div class="reset-section">
                    <p>重置游戏将清除所有进度，包括金币、物品和技能等级</p>
                    <p>此操作不可撤销，请谨慎操作！</p>
                    
                    <div class="reset-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>警告!</h3>
                        <p>重置后所有游戏数据将被永久删除</p>
                    </div>
                    
                    <button class="reset-btn" id="confirmReset">
                        <i class="fas fa-trash-alt"></i> 确认重置游戏
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification-content">
            <i class="fas fa-check-circle"></i>
            <div id="notificationText">搜刮完成！获得了 1 件物资</div>
        </div>
    </div>
    
    <!-- 离线收益弹窗 -->
    <div class="offline-modal" id="offlineModal">
        <div class="offline-content">
            <button class="close-offline" id="closeOffline"><i class="fas fa-times"></i></button>
            <div class="offline-header">
                <h2><i class="fas fa-history"></i> 离线收益</h2>
                <p>您不在线期间自动搜刮获得的物资</p>
            </div>
            
            <div class="offline-stats">
                <div class="offline-stat">
                    <div>搜刮次数</div>
                    <div class="offline-stat-value" id="offlineCount">0</div>
                </div>
                <div class="offline-stat">
                    <div>获得物品</div>
                    <div class="offline-stat-value" id="offlineItems">0</div>
                </div>
                <div class="offline-stat">
                    <div>离线时间</div>
                    <div class="offline-stat-value" id="offlineTime">0分钟</div>
                </div>
            </div>
            
            <div class="offline-items">
                <h3><i class="fas fa-gift"></i> 获得的物资</h3>
                <div class="offline-item-grid" id="offlineItemsGrid">
                    <!-- 离线物品将通过JS动态添加 -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 游戏数据模型
        const GameData = {
            gold: 500,
            scavengeCount: 0,
            items: [], // 现在存储 {id, name, rarity, basePrice, currentPrice, quantity}
            skills: {
                quantity: 0,
                rarity: 0,
                speed: 0
            },
            scavengeStartTime: 0,
            currentScavengeTime: 0,
            currentScavengeTimeSeconds: 0,
            isScavenging: false,
            autoScavenge: false,
            autoInterval: null,
            lastPriceUpdate: Date.now(),
            priceMultiplier: 1.0,
            lastSavedTime: Date.now(),
            offlineGains: [],
            
            // 物品名称库
            itemNames: {
                0: ["生锈的铁片", "破布", "木棍", "碎石块", "脏水瓶", "断裂的皮带", "磨损的皮革"],
                1: ["皮革", "铜矿石", "亚麻布", "草药", "粗糙的宝石", "铁钉", "动物骨头"],
                2: ["铁锭", "银矿石", "魔法粉尘", "蓝宝石", "能量水晶", "机械零件", "精制木材"],
                3: ["金锭", "紫水晶", "附魔卷轴", "龙鳞", "星尘", "古代符文", "精灵丝绸"],
                4: ["秘银锭", "红宝石", "灵魂石", "凤凰羽毛", "时间沙漏", "恶魔之角", "天使之羽"],
                5: ["星辰碎片", "神之泪", "永恒结晶", "创世之种", "宇宙之心", "时空钥匙", "无限宝石"]
            },
            
            // 基础价格
            basePrices: [5, 25, 100, 500, 2500, 10000],
            
            // 获取升级所需金币
            getUpgradeCost: function(level) {
                return 100 * Math.pow(2, level);
            },
            
            // 获取搜刮时间
            getScavengeTime: function() {
                return Math.max(5, 20 - this.skills.speed * 0.5);
            },
            
            // 获取每次搜刮物品数量
            getScavengeQuantity: function() {
                // 随机数量：1 到 (1 + 技能等级)
                return 1 + Math.floor(Math.random() * (1 + this.skills.quantity));
            },
            
            // 获取稀有物品概率
            getRarityProbability: function() {
                // 基础概率 + 技能加成
                return Math.min(0.5, 0.005 + this.skills.rarity * 0.005);
            },
            
            // 生成随机物品
            generateItem: function() {
                const rand = Math.random();
                let rarity;
                
                // 根据概率确定物品稀有度
                if (rand < 0.0005 + this.getRarityProbability()) {
                    rarity = 5; // 神话
                } else if (rand < 0.025) {
                    rarity = 4; // 传奇
                } else if (rand < 0.07) {
                    rarity = 3; // 史诗
                } else if (rand < 0.15) {
                    rarity = 2; // 精良
                } else if (rand < 0.4) {
                    rarity = 1; // 优秀
                } else {
                    rarity = 0; // 普通
                }
                
                // 随机选择物品名称
                const names = this.itemNames[rarity];
                const name = names[Math.floor(Math.random() * names.length)];
                
                // 计算当前价格（受市场波动影响）
                const basePrice = this.basePrices[rarity];
                const currentPrice = Math.floor(basePrice * this.priceMultiplier);
                
                return {
                    name: name,
                    rarity: rarity,
                    basePrice: basePrice,
                    currentPrice: currentPrice
                };
            },
            
            // 添加物品到背包（支持堆叠）
            addItemToInventory: function(newItem) {
                // 查找是否有相同名称和稀有度的物品
                const existingItem = this.items.find(item => 
                    item.name === newItem.name && item.rarity === newItem.rarity);
                
                if (existingItem) {
                    // 如果存在，增加数量
                    existingItem.quantity += 1;
                } else {
                    // 否则添加新物品
                    this.items.push({
                        id: Date.now() + Math.random(),
                        name: newItem.name,
                        rarity: newItem.rarity,
                        basePrice: newItem.basePrice,
                        currentPrice: newItem.currentPrice,
                        quantity: 1
                    });
                }
            },
            
            // 开始搜刮
            startScavenge: function() {
                if (this.isScavenging) return;
                
                this.isScavenging = true;
                this.scavengeStartTime = Date.now();
                this.currentScavengeTimeSeconds = this.getScavengeTime();
                this.currentScavengeTime = this.currentScavengeTimeSeconds * 1000;
                
                // 设置初始倒计时文本
                document.getElementById('progressText').textContent = this.currentScavengeTimeSeconds + "秒";
                
                updateUI();
            },
            
            // 完成搜刮
            completeScavenge: function() {
                const quantity = this.getScavengeQuantity();
                const gainedItems = [];
                
                for (let i = 0; i < quantity; i++) {
                    const item = this.generateItem();
                    this.addItemToInventory(item);
                    gainedItems.push(item);
                }
                
                this.scavengeCount++;
                this.isScavenging = false;
                
                // 检查是否解锁自动搜刮
                if (this.scavengeCount >= 10 && !this.autoScavenge) {
                    document.getElementById('autoSection').style.display = 'block';
                }
                
                saveGame();
                updateUI();
                
                showNotification(`搜刮完成！获得了 ${quantity} 件物资`, false);
                
                // 重置进度条
                document.getElementById('scavengeProgress').style.width = '0%';
                document.getElementById('progressText').textContent = '准备搜刮';
                
                return gainedItems;
            },
            
            // 切换自动搜刮
            toggleAutoScavenge: function() {
                this.autoScavenge = !this.autoScavenge;
                
                if (this.autoScavenge) {
                    this.startAutoScavenge();
                    showNotification("自动搜刮已开启 - 即使关闭页面也会继续", false);
                } else {
                    this.stopAutoScavenge();
                    showNotification("自动搜刮已关闭", false);
                }
                
                saveGame();
                updateUI();
            },
            
            // 开始自动搜刮
            startAutoScavenge: function() {
                // 清除现有定时器（如果有）
                this.stopAutoScavenge();
                
                // 确保不在搜刮中
                if (this.isScavenging) return;
                
                // 立即开始一次搜刮
                this.startScavenge();
                
                // 设置定时器
                this.autoInterval = setInterval(() => {
                    if (!this.isScavenging) {
                        this.startScavenge();
                    }
                }, this.getScavengeTime() * 1000 + 100);
            },
            
            // 停止自动搜刮
            stopAutoScavenge: function() {
                if (this.autoInterval) {
                    clearInterval(this.autoInterval);
                    this.autoInterval = null;
                }
            },
            
            // 出售物品
            sellItem: function(itemId) {
                const itemIndex = this.items.findIndex(item => item.id === itemId);
                if (itemIndex !== -1) {
                    const item = this.items[itemIndex];
                    
                    // 计算总价值
                    const totalValue = item.currentPrice * item.quantity;
                    this.gold += totalValue;
                    
                    // 移除物品
                    this.items.splice(itemIndex, 1);
                    
                    saveGame();
                    updateUI();
                    
                    showNotification(`出售成功！获得 ${totalValue} 金币`, false);
                    return true;
                }
                return false;
            },
            
            // 升级技能
            upgradeSkill: function(skill) {
                if (this.skills[skill] >= 30) {
                    showNotification("该技能已达最高等级", true);
                    return false;
                }
                
                const cost = this.getUpgradeCost(this.skills[skill]);
                if (this.gold >= cost) {
                    this.gold -= cost;
                    this.skills[skill]++;
                    
                    // 如果升级的是搜刮效率，重新设置自动搜刮
                    if (skill === 'speed' && this.autoScavenge) {
                        this.stopAutoScavenge();
                        this.startAutoScavenge();
                    }
                    
                    saveGame();
                    updateUI();
                    
                    showNotification(`技能升级成功！`, false);
                    return true;
                } else {
                    showNotification("金币不足", true);
                    return false;
                }
            },
            
            // 重置游戏
            resetGame: function() {
                this.gold = 500;
                this.scavengeCount = 0;
                this.items = [];
                this.skills = {
                    quantity: 0,
                    rarity: 0,
                    speed: 0
                };
                this.scavengeStartTime = 0;
                this.currentScavengeTime = 0;
                this.isScavenging = false;
                this.autoScavenge = false;
                this.stopAutoScavenge();
                this.lastPriceUpdate = Date.now();
                this.priceMultiplier = 1.0;
                this.lastSavedTime = Date.now();
                this.offlineGains = [];
                
                saveGame();
                updateUI();
                
                // 隐藏自动搜刮区域
                document.getElementById('autoSection').style.display = 'none';
                
                // 重置进度条
                document.getElementById('scavengeProgress').style.width = '0%';
                document.getElementById('progressText').textContent = '准备搜刮';
                
                showNotification("游戏已重置", false);
            },
            
            // 更新市场价格
            updatePrices: function() {
                // 每5分钟更新一次价格
                const now = Date.now();
                if (now - this.lastPriceUpdate > 5 * 60 * 1000) {
                    // 价格在0.7到1.3之间波动
                    this.priceMultiplier = 0.7 + Math.random() * 0.6;
                    this.lastPriceUpdate = now;
                    
                    // 更新所有物品的当前价格
                    this.items.forEach(item => {
                        item.currentPrice = Math.floor(item.basePrice * this.priceMultiplier);
                    });
                    
                    saveGame();
                    updateUI();
                    
                    const trend = this.priceMultiplier > 1 ? '上涨' : '下跌';
                    const changePercent = Math.round((this.priceMultiplier - 1) * 100);
                    showNotification(`市场价格已更新！${changePercent > 0 ? '+' : ''}${changePercent}%`, false);
                }
            },
            
            // 获取搜刮进度
            getScavengeProgress: function() {
                if (!this.isScavenging) return 0;
                
                const elapsed = Date.now() - this.scavengeStartTime;
                return Math.min(100, (elapsed / this.currentScavengeTime) * 100);
            },
            
            // 获取剩余时间（秒）
            getRemainingTime: function() {
                if (!this.isScavenging) return 0;
                
                const elapsed = Date.now() - this.scavengeStartTime;
                const remaining = Math.max(0, this.currentScavengeTime - elapsed);
                return Math.ceil(remaining / 1000);
            },
            
            // 处理离线期间的自动搜刮
            processOfflineScavenging: function() {
                if (!this.autoScavenge) return;
                
                const now = Date.now();
                const elapsed = now - this.lastSavedTime;
                
                // 计算可以完成多少次搜刮
                const scavengeTime = this.getScavengeTime() * 1000;
                const scavengeCount = Math.floor(elapsed / scavengeTime);
                
                if (scavengeCount > 0) {
                    const gainedItems = [];
                    
                    for (let i = 0; i < scavengeCount; i++) {
                        const quantity = this.getScavengeQuantity();
                        for (let j = 0; j < quantity; j++) {
                            const item = this.generateItem();
                            this.addItemToInventory(item);
                            gainedItems.push(item);
                        }
                        this.scavengeCount++;
                    }
                    
                    // 统计离线获得的物品
                    const itemStats = {};
                    gainedItems.forEach(item => {
                        const key = item.name + "|" + item.rarity;
                        if (!itemStats[key]) {
                            itemStats[key] = {
                                name: item.name,
                                rarity: item.rarity,
                                count: 0
                            };
                        }
                        itemStats[key].count++;
                    });
                    
                    this.offlineGains = {
                        count: scavengeCount,
                        items: Object.values(itemStats),
                        time: Math.floor(elapsed / 60000), // 分钟
                        totalItems: gainedItems.length
                    };
                    
                    saveGame();
                    updateUI();
                    
                    // 显示离线收益弹窗
                    showOfflineGains();
                }
            }
        };

        // 显示离线收益
        function showOfflineGains() {
            if (GameData.offlineGains && GameData.offlineGains.count > 0) {
                const gains = GameData.offlineGains;
                
                // 更新统计数据
                document.getElementById('offlineCount').textContent = gains.count;
                document.getElementById('offlineItems').textContent = gains.totalItems;
                document.getElementById('offlineTime').textContent = gains.time + "分钟";
                
                // 清空物品网格
                const itemsGrid = document.getElementById('offlineItemsGrid');
                itemsGrid.innerHTML = '';
                
                // 添加物品
                gains.items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'offline-item';
                    itemElement.innerHTML = `
                        <div class="item-name rarity-${item.rarity}">${item.name}</div>
                        <div class="item-rarity">${getRarityName(item.rarity)}</div>
                        <div class="item-quantity">x${item.count}</div>
                    `;
                    itemsGrid.appendChild(itemElement);
                });
                
                // 显示弹窗
                document.getElementById('offlineModal').classList.add('active');
                
                // 清空离线收益数据
                GameData.offlineGains = [];
            }
        }

        // 初始化游戏
        function initGame() {
            loadGame();
            setupEventListeners();
            updateUI();
            
            // 处理离线期间的自动搜刮
            GameData.processOfflineScavenging();
            
            // 开始游戏循环
            setInterval(gameLoop, 100);
        }

        // 游戏主循环
        function gameLoop() {
            GameData.updatePrices();
            
            // 更新搜刮进度
            if (GameData.isScavenging) {
                const progress = GameData.getScavengeProgress();
                document.getElementById('scavengeProgress').style.width = progress + '%';
                
                // 更新倒计时文本
                const remainingTime = GameData.getRemainingTime();
                document.getElementById('progressText').textContent = remainingTime + "秒";
                
                // 检查是否完成搜刮
                if (progress >= 100) {
                    GameData.completeScavenge();
                }
            }
            
            updateUI();
            
            // 每分钟自动保存一次
            const now = Date.now();
            if (now - GameData.lastSavedTime > 60 * 1000) {
                GameData.lastSavedTime = now;
                saveGame();
            }
        }

        // 加载游戏
        function loadGame() {
            const savedData = localStorage.getItem('scavengerGameData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                Object.assign(GameData, parsedData);
                
                // 恢复自动搜刮
                if (GameData.autoScavenge) {
                    GameData.startAutoScavenge();
                }
                
                // 显示自动搜刮解锁区域
                if (GameData.scavengeCount >= 10) {
                    document.getElementById('autoSection').style.display = 'block';
                }
                
                // 恢复搜刮状态
                if (GameData.isScavenging) {
                    const elapsed = Date.now() - GameData.scavengeStartTime;
                    if (elapsed < GameData.currentScavengeTime) {
                        // 继续搜刮
                        GameData.isScavenging = true;
                    } else {
                        // 搜刮已完成但未处理
                        GameData.completeScavenge();
                    }
                }
            }
        }

        // 保存游戏
        function saveGame() {
            GameData.lastSavedTime = Date.now();
            localStorage.setItem('scavengerGameData', JSON.stringify(GameData));
        }

        // 设置事件监听
        function setupEventListeners() {
            // 菜单按钮
            document.getElementById('scavengeBtn').addEventListener('click', () => showPanel('scavengePanel'));
            document.getElementById('inventoryBtn').addEventListener('click', () => showPanel('inventoryPanel'));
            document.getElementById('skillsBtn').addEventListener('click', () => showPanel('skillsPanel'));
            document.getElementById('guideBtn').addEventListener('click', () => showPanel('guidePanel'));
            document.getElementById('resetBtn').addEventListener('click', () => showPanel('resetPanel'));
            
            // 搜刮按钮
            document.getElementById('startScavenge').addEventListener('click', () => {
                GameData.startScavenge();
            });
            
            // 自动搜刮按钮
            document.getElementById('toggleAuto').addEventListener('click', () => {
                GameData.toggleAutoScavenge();
            });
            
            // 技能升级按钮
            document.getElementById('upgradeQuantity').addEventListener('click', () => {
                GameData.upgradeSkill('quantity');
            });
            
            document.getElementById('upgradeRarity').addEventListener('click', () => {
                GameData.upgradeSkill('rarity');
            });
            
            document.getElementById('upgradeSpeed').addEventListener('click', () => {
                GameData.upgradeSkill('speed');
            });
            
            // 重置游戏按钮
            document.getElementById('confirmReset').addEventListener('click', () => {
                if (confirm('确定要重置游戏吗？所有进度都将丢失！')) {
                    GameData.resetGame();
                }
            });
            
            // 关闭离线收益弹窗
            document.getElementById('closeOffline').addEventListener('click', () => {
                document.getElementById('offlineModal').classList.remove('active');
            });
        }

        // 显示面板
        function showPanel(panelId) {
            // 隐藏所有面板
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // 移除所有按钮的活动状态
            document.querySelectorAll('.menu button').forEach(button => {
                button.classList.remove('active');
            });
            
            // 显示选中的面板
            document.getElementById(panelId).classList.add('active');
            
            // 设置按钮为活动状态
            const buttonMap = {
                'scavengePanel': 'scavengeBtn',
                'inventoryPanel': 'inventoryBtn',
                'skillsPanel': 'skillsBtn',
                'guidePanel': 'guideBtn',
                'resetPanel': 'resetBtn'
            };
            document.getElementById(buttonMap[panelId]).classList.add('active');
            
            // 如果是背包面板，更新物品列表
            if (panelId === 'inventoryPanel') {
                renderInventory();
            }
        }

        // 更新UI
        function updateUI() {
            // 更新统计数据
            document.getElementById('gold').textContent = GameData.gold;
            document.getElementById('scavengeCount').textContent = GameData.scavengeCount;
            
            // 计算物品总数（考虑堆叠数量）
            const totalItems = GameData.items.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('itemCount').textContent = totalItems;
            
            document.getElementById('autoStatus').textContent = GameData.autoScavenge ? '开启' : '关闭';
            
            // 更新搜刮按钮状态
            const scavengeBtn = document.getElementById('startScavenge');
            scavengeBtn.disabled = GameData.isScavenging;
            
            // 更新技能信息
            document.getElementById('quantityLevel').textContent = GameData.skills.quantity;
            document.getElementById('rarityLevel').textContent = GameData.skills.rarity;
            document.getElementById('speedLevel').textContent = GameData.skills.speed;
            
            document.getElementById('quantityCost').textContent = GameData.getUpgradeCost(GameData.skills.quantity);
            document.getElementById('rarityCost').textContent = GameData.getUpgradeCost(GameData.skills.rarity);
            document.getElementById('speedCost').textContent = GameData.getUpgradeCost(GameData.skills.speed);
            
            // 更新技能进度条
            document.getElementById('quantityProgress').style.width = (GameData.skills.quantity / 30) * 100 + '%';
            document.getElementById('rarityProgress').style.width = (GameData.skills.rarity / 30) * 100 + '%';
            document.getElementById('speedProgress').style.width = (GameData.skills.speed / 30) * 100 + '%';
            
            // 更新自动搜刮按钮文本
            const autoBtn = document.getElementById('toggleAuto');
            if (autoBtn) {
                autoBtn.textContent = GameData.autoScavenge ? '关闭自动搜刮' : '开启自动搜刮';
            }
        }

        // 渲染背包
        function renderInventory() {
            const inventoryGrid = document.getElementById('inventoryGrid');
            inventoryGrid.innerHTML = '';
            
            if (GameData.items.length === 0) {
                inventoryGrid.innerHTML = '<p class="empty-message" style="grid-column:1/-1;text-align:center;padding:40px;color:#95a5a6;">背包空空如也，快去搜刮物资吧！</p>';
                return;
            }
            
            GameData.items.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';
                
                // 添加物品信息
                itemCard.innerHTML = `
                    <div class="item-name rarity-${item.rarity}">${item.name}</div>
                    <div class="item-rarity">${getRarityName(item.rarity)}</div>
                    <div class="item-price">${item.currentPrice} 金币/个</div>
                    <div class="item-quantity">x${item.quantity}</div>
                    <button class="sell-btn" data-id="${item.id}"><i class="fas fa-coins"></i> 出售全部</button>
                `;
                
                inventoryGrid.appendChild(itemCard);
            });
            
            // 添加出售事件监听
            document.querySelectorAll('.sell-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const itemId = parseFloat(e.target.getAttribute('data-id'));
                    GameData.sellItem(itemId);
                    renderInventory(); // 重新渲染背包
                });
            });
        }

        // 获取稀有度名称
        function getRarityName(rarity) {
            const names = ['普通', '优秀', '精良', '史诗', '传奇', '神话'];
            return names[rarity];
        }

        // 显示通知
        function showNotification(message, isError) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            const icon = notification.querySelector('i');
            
            text.textContent = message;
            
            if (isError) {
                notification.className = 'notification error';
                icon.className = 'fas fa-exclamation-circle';
            } else {
                notification.className = 'notification';
                icon.className = 'fas fa-check-circle';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 启动游戏
        window.addEventListener('DOMContentLoaded', initGame);
        
        // 页面关闭前保存游戏
        window.addEventListener('beforeunload', () => {
            saveGame();
        });
    </script>
</body>
</html>

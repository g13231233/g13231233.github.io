<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å® ç‰©æ‰­è›‹ä¹å›­</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Marker Felt', 'Arial Rounded MT Bold', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            padding: 20px;
            color: #5a3921;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border: 4px solid #ff9e6d;
        }
        
        h1 {
            font-size: 3.5rem;
            color: #ff6b6b;
            text-shadow: 3px 3px 0 #ffd166;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .coin-count {
            background: #ffd166;
            padding: 8px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .claim-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border: 4px solid #06d6a0;
        }
        
        .timer {
            font-size: 1.8rem;
            margin: 20px 0;
            color: #ef476f;
            font-weight: bold;
        }
        
        .claim-btn {
            background: linear-gradient(to right, #ff9e6d, #ff6b6b);
            border: none;
            border-radius: 50px;
            padding: 15px 40px;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(255,107,107,0.4);
        }
        
        .claim-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(255,107,107,0.6);
        }
        
        .claim-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #118ab2;
            text-align: center;
            border-bottom: 3px dashed #ffd166;
            padding-bottom: 10px;
        }
        
        .eggs-container, .pets-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            min-height: 200px;
        }
        
        .egg-item, .pet-item {
            background: white;
            border-radius: 15px;
            padding: 15px 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .egg-item:hover, .pet-item:hover {
            transform: translateY(-5px);
        }
        
        .egg-icon {
            font-size: 3.5rem;
            margin-bottom: 10px;
        }
        
        .pet-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .rarity {
            font-size: 0.9rem;
            padding: 3px 8px;
            border-radius: 10px;
            color: white;
            display: inline-block;
            margin-top: 5px;
        }
        
        .common { background: #8a8a8a; }
        .rare { background: #4ea8de; }
        .epic { background: #9b5de5; }
        .legendary { background: #f15bb5; }
        
        .market, .shop {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .market-items, .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
        
        .market-item, .shop-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .price {
            font-weight: bold;
            color: #d4af37;
            font-size: 1.2rem;
            margin: 10px 0;
        }
        
        .action-btn {
            background: #06d6a0;
            border: none;
            border-radius: 10px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            width: 100%;
        }
        
        .action-btn:hover {
            background: #05b88a;
        }
        
        .empty-msg {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 30px;
            grid-column: 1 / -1;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #06d6a0;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(200%);
            transition: transform 0.5s;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .egg-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 10rem;
            z-index: 999;
            transition: transform 0.5s, opacity 0.5s;
            opacity: 0;
            text-shadow: 0 0 20px rgba(255,255,255,0.8);
        }
        
        .egg-animation.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        
        .pet-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
            transition: transform 0.5s;
            width: 300px;
        }
        
        .pet-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }
        
        .pet-popup .pet-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ff6b6b;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .market-items, .shop-items {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-egg"></i> å® ç‰©æ‰­è›‹ä¹å›­</h1>
            <p>æ”¶é›†å¯çˆ±çš„å® ç‰©ï¼Œåœ¨é›†å¸‚äº¤æ˜“ï¼Œå»ºç«‹ä½ çš„å® ç‰©ç‹å›½ï¼</p>
            <div class="stats">
                <div class="coin-count">
                    <i class="fas fa-coins"></i>
                    <span id="coins">500</span> é‡‘å¸
                </div>
            </div>
        </header>
        
        <section class="claim-section">
            <h2>å…è´¹æ‰­è›‹é¢†å–</h2>
            <div class="timer" id="timer">00:10:00</div>
            <button class="claim-btn" id="claim-btn" disabled>é¢†å–æ‰­è›‹</button>
        </section>
        
        <div class="main-content">
            <div class="section">
                <h3 class="section-title"><i class="fas fa-basketball-ball"></i> è›‹èƒŒåŒ…</h3>
                <div class="eggs-container" id="eggs-container">
                    <!-- è›‹ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title"><i class="fas fa-paw"></i> å® ç‰©èƒŒåŒ…</h3>
                <div class="pets-container" id="pets-container">
                    <!-- å® ç‰©ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
            </div>
        </div>
        
        <section class="market">
            <h3 class="section-title"><i class="fas fa-store"></i> é›†å¸‚</h3>
            <p class="timer">ä¸‹æ¬¡ä»·æ ¼æ›´æ–°: <span id="market-timer">00:10:00</span></p>
            <div class="market-items" id="market-items">
                <!-- é›†å¸‚ç‰©å“ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
        </section>
        
        <section class="shop">
            <h3 class="section-title"><i class="fas fa-shopping-cart"></i> å® ç‰©è›‹å•†åº—</h3>
            <p class="timer">ä¸‹æ¬¡ä»·æ ¼æ›´æ–°: <span id="shop-timer">00:10:00</span></p>
            <div class="shop-items" id="shop-items">
                <!-- å•†åº—ç‰©å“ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
        </section>
    </div>
    
    <div class="egg-animation" id="egg-animation">ğŸ¥š</div>
    
    <div class="pet-popup" id="pet-popup">
        <div class="close-btn" id="close-popup">Ã—</div>
        <div class="pet-icon" id="popup-pet-icon">ğŸ¶</div>
        <h3 id="popup-pet-name">å® ç‰©åå­—</h3>
        <div class="rarity" id="popup-pet-rarity">ç¨€æœ‰åº¦</div>
        <p>æ­å–œä½ è·å¾—äº†æ–°å® ç‰©ï¼</p>
    </div>
    
    <div class="notification" id="notification">æˆåŠŸé¢†å–äº†æ‰­è›‹ï¼</div>
    
    <script>
        // æ¸¸æˆæ•°æ®
        const gameData = {
            coins: 500,
            eggs: [],
            pets: [],
            lastClaim: null,
            lastMarketUpdate: null,
            lastShopUpdate: null,
            
            // è›‹çš„ç¨€æœ‰åº¦åŠæ¦‚ç‡
            eggRarities: [
                { name: "æ™®é€š", chance: 60, icon: "ğŸ¥š", colorClass: "common" },
                { name: "ç¨€æœ‰", chance: 25, icon: "ğŸ¥š", colorClass: "rare" },
                { name: "å²è¯—", chance: 10, icon: "ğŸ¥š", colorClass: "epic" },
                { name: "ä¼ è¯´", chance: 5, icon: "ğŸ¥š", colorClass: "legendary" }
            ],
            
            // å® ç‰©æ•°æ®
            petTypes: [
                { name: "å°çŒ«å’ª", rarity: "æ™®é€š", icon: "ğŸ±", colorClass: "common" },
                { name: "å°ç‹—", rarity: "æ™®é€š", icon: "ğŸ¶", colorClass: "common" },
                { name: "å…”å­", rarity: "æ™®é€š", icon: "ğŸ°", colorClass: "common" },
                { name: "å°ç†ŠçŒ«", rarity: "ç¨€æœ‰", icon: "ğŸ¼", colorClass: "rare" },
                { name: "ç‹ç‹¸", rarity: "ç¨€æœ‰", icon: "ğŸ¦Š", colorClass: "rare" },
                { name: "åˆºçŒ¬", rarity: "ç¨€æœ‰", icon: "ğŸ¦”", colorClass: "rare" },
                { name: "ç‹¬è§’å…½", rarity: "å²è¯—", icon: "ğŸ¦„", colorClass: "epic" },
                { name: "å‡¤å‡°", rarity: "å²è¯—", icon: "ğŸ¦š", colorClass: "epic" },
                { name: "é¾™", rarity: "ä¼ è¯´", icon: "ğŸ‰", colorClass: "legendary" },
                { name: "éº’éºŸ", rarity: "ä¼ è¯´", icon: "ğŸ¦’", colorClass: "legendary" }
            ],
            
            // é›†å¸‚ä»·æ ¼èŒƒå›´
            marketPrices: {
                "æ™®é€š": { min: 10, max: 30 },
                "ç¨€æœ‰": { min: 50, max: 100 },
                "å²è¯—": { min: 150, max: 300 },
                "ä¼ è¯´": { min: 500, max: 1000 }
            },
            
            // å•†åº—ä»·æ ¼èŒƒå›´
            shopPrices: {
                "æ™®é€š": { min: 15, max: 25 },
                "ç¨€æœ‰": { min: 60, max: 90 },
                "å²è¯—": { min: 200, max: 280 },
                "ä¼ è¯´": { min: 600, max: 900 }
            },
            
            // å½“å‰ä»·æ ¼
            currentMarketPrices: {},
            currentShopPrices: {}
        };
        
        // DOM å…ƒç´ 
        const elements = {
            coins: document.getElementById('coins'),
            timer: document.getElementById('timer'),
            marketTimer: document.getElementById('market-timer'),
            shopTimer: document.getElementById('shop-timer'),
            claimBtn: document.getElementById('claim-btn'),
            eggsContainer: document.getElementById('eggs-container'),
            petsContainer: document.getElementById('pets-container'),
            marketItems: document.getElementById('market-items'),
            shopItems: document.getElementById('shop-items'),
            eggAnimation: document.getElementById('egg-animation'),
            petPopup: document.getElementById('pet-popup'),
            closePopup: document.getElementById('close-popup'),
            popupPetIcon: document.getElementById('popup-pet-icon'),
            popupPetName: document.getElementById('popup-pet-name'),
            popupPetRarity: document.getElementById('popup-pet-rarity'),
            notification: document.getElementById('notification')
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // å°è¯•ä» localStorage åŠ è½½æ¸¸æˆæ•°æ®
            const savedData = localStorage.getItem('petGachaGame');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                Object.assign(gameData, parsedData);
            } else {
                // åˆå§‹åŒ–ä»·æ ¼
                updateMarketPrices();
                updateShopPrices();
            }
            
            // æ›´æ–°UI
            updateUI();
            
            // è®¾ç½®å®šæ—¶å™¨
            startTimers();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
        }
        
        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°é‡‘å¸
            elements.coins.textContent = gameData.coins;
            
            // æ›´æ–°è›‹èƒŒåŒ…
            renderEggs();
            
            // æ›´æ–°å® ç‰©èƒŒåŒ…
            renderPets();
            
            // æ›´æ–°é›†å¸‚
            renderMarket();
            
            // æ›´æ–°å•†åº—
            renderShop();
        }
        
        // æ¸²æŸ“è›‹èƒŒåŒ…
        function renderEggs() {
            elements.eggsContainer.innerHTML = '';
            
            if (gameData.eggs.length === 0) {
                elements.eggsContainer.innerHTML = '<div class="empty-msg">è›‹èƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿï¼Œå¿«å»é¢†å–æ‰­è›‹å§ï¼</div>';
                return;
            }
            
            gameData.eggs.forEach((egg, index) => {
                const eggElement = document.createElement('div');
                eggElement.className = 'egg-item';
                eggElement.innerHTML = `
                    <div class="egg-icon">${egg.icon}</div>
                    <div>${egg.name}</div>
                    <div class="rarity ${egg.colorClass}">${egg.rarity}</div>
                `;
                
                eggElement.addEventListener('click', () => hatchEgg(index));
                elements.eggsContainer.appendChild(eggElement);
            });
        }
        
        // æ¸²æŸ“å® ç‰©èƒŒåŒ…
        function renderPets() {
            elements.petsContainer.innerHTML = '';
            
            if (gameData.pets.length === 0) {
                elements.petsContainer.innerHTML = '<div class="empty-msg">è¿˜æ²¡æœ‰å® ç‰©ï¼Œå¿«å»å­µåŒ–æ‰­è›‹å§ï¼</div>';
                return;
            }
            
            gameData.pets.forEach((pet, index) => {
                const petElement = document.createElement('div');
                petElement.className = 'pet-item';
                petElement.innerHTML = `
                    <div class="pet-icon">${pet.icon}</div>
                    <div>${pet.name}</div>
                    <div class="rarity ${pet.colorClass}">${pet.rarity}</div>
                `;
                
                petElement.addEventListener('click', () => sellPet(index));
                elements.petsContainer.appendChild(petElement);
            });
        }
        
        // æ¸²æŸ“é›†å¸‚
        function renderMarket() {
            elements.marketItems.innerHTML = '';
            
            const rarityGroups = {};
            
            // æŒ‰ç¨€æœ‰åº¦åˆ†ç»„å® ç‰©
            gameData.pets.forEach(pet => {
                if (!rarityGroups[pet.rarity]) {
                    rarityGroups[pet.rarity] = [];
                }
                rarityGroups[pet.rarity].push(pet);
            });
            
            // ä¸ºæ¯ä¸ªç¨€æœ‰åº¦åˆ›å»ºå¸‚åœºé¡¹
            Object.keys(rarityGroups).forEach(rarity => {
                const group = rarityGroups[rarity];
                const price = gameData.currentMarketPrices[rarity];
                
                const marketItem = document.createElement('div');
                marketItem.className = 'market-item';
                marketItem.innerHTML = `
                    <div class="pet-icon">${group[0].icon}</div>
                    <h3>${rarity}å® ç‰©</h3>
                    <div>åº“å­˜: ${group.length}</div>
                    <div class="price">${price} é‡‘å¸</div>
                    <button class="action-btn sell-all-btn" data-rarity="${rarity}">å…¨éƒ¨å‡ºå”®</button>
                `;
                
                elements.marketItems.appendChild(marketItem);
            });
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.querySelectorAll('.sell-all-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const rarity = btn.getAttribute('data-rarity');
                    sellAllPetsByRarity(rarity);
                });
            });
        }
        
        // æ¸²æŸ“å•†åº—
        function renderShop() {
            elements.shopItems.innerHTML = '';
            
            gameData.eggRarities.forEach(rarity => {
                const price = gameData.currentShopPrices[rarity.name];
                
                const shopItem = document.createElement('div');
                shopItem.className = 'shop-item';
                shopItem.innerHTML = `
                    <div class="egg-icon">${rarity.icon}</div>
                    <h3>${rarity.name}è›‹</h3>
                    <div class="price">${price} é‡‘å¸</div>
                    <button class="action-btn buy-btn" data-rarity="${rarity.name}">è´­ä¹°</button>
                `;
                
                elements.shopItems.appendChild(shopItem);
            });
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.querySelectorAll('.buy-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const rarity = btn.getAttribute('data-rarity');
                    buyEgg(rarity);
                });
            });
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // é¢†å–æ‰­è›‹æŒ‰é’®
            elements.claimBtn.addEventListener('click', claimEgg);
            
            // å…³é—­å® ç‰©å¼¹çª—
            elements.closePopup.addEventListener('click', () => {
                elements.petPopup.classList.remove('show');
            });
        }
        
        // å¼€å§‹è®¡æ—¶å™¨
        function startTimers() {
            // ä¸»è®¡æ—¶å™¨
            setInterval(() => {
                updateTimers();
            }, 1000);
            
            updateTimers();
        }
        
        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimers() {
            const now = Date.now();
            
            // æ‰­è›‹é¢†å–è®¡æ—¶å™¨
            if (!gameData.lastClaim || now - gameData.lastClaim >= 600000) {
                elements.timer.textContent = "00:00:00";
                elements.claimBtn.disabled = false;
            } else {
                const remaining = 600000 - (now - gameData.lastClaim);
                const timeStr = formatTime(remaining);
                elements.timer.textContent = timeStr;
                elements.claimBtn.disabled = true;
            }
            
            // å¸‚åœºæ›´æ–°è®¡æ—¶å™¨
            if (!gameData.lastMarketUpdate || now - gameData.lastMarketUpdate >= 600000) {
                updateMarketPrices();
                gameData.lastMarketUpdate = now;
                elements.marketTimer.textContent = "00:00:00";
            } else {
                const remaining = 600000 - (now - gameData.lastMarketUpdate);
                elements.marketTimer.textContent = formatTime(remaining);
            }
            
            // å•†åº—æ›´æ–°è®¡æ—¶å™¨
            if (!gameData.lastShopUpdate || now - gameData.lastShopUpdate >= 600000) {
                updateShopPrices();
                gameData.lastShopUpdate = now;
                elements.shopTimer.textContent = "00:00:00";
            } else {
                const remaining = 600000 - (now - gameData.lastShopUpdate);
                elements.shopTimer.textContent = formatTime(remaining);
            }
            
            // ä¿å­˜æ¸¸æˆçŠ¶æ€
            saveGame();
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        
        // é¢†å–æ‰­è›‹
        function claimEgg() {
            // éšæœºè·å–ç¨€æœ‰åº¦
            const randomNum = Math.random() * 100;
            let cumulative = 0;
            let selectedRarity;
            
            for (const rarity of gameData.eggRarities) {
                cumulative += rarity.chance;
                if (randomNum <= cumulative) {
                    selectedRarity = rarity;
                    break;
                }
            }
            
            // åˆ›å»ºæ–°è›‹
            const newEgg = {
                id: Date.now(),
                name: `${selectedRarity.name}è›‹`,
                rarity: selectedRarity.name,
                icon: selectedRarity.icon,
                colorClass: selectedRarity.colorClass
            };
            
            // æ·»åŠ åˆ°è›‹èƒŒåŒ…
            gameData.eggs.push(newEgg);
            gameData.lastClaim = Date.now();
            
            // æ˜¾ç¤ºåŠ¨ç”»
            showEggAnimation(newEgg);
            
            // æ›´æ–°UI
            updateUI();
        }
        
        // æ˜¾ç¤ºè›‹åŠ¨ç”»
        function showEggAnimation(egg) {
            elements.eggAnimation.textContent = egg.icon;
            elements.eggAnimation.className = 'egg-animation show';
            elements.eggAnimation.style.color = getRarityColor(egg.rarity);
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`è·å¾—äº†${egg.rarity}è›‹ï¼`);
            
            // 3ç§’åéšè—åŠ¨ç”»
            setTimeout(() => {
                elements.eggAnimation.className = 'egg-animation';
            }, 3000);
        }
        
        // å­µåŒ–è›‹
        function hatchEgg(eggIndex) {
            const egg = gameData.eggs[eggIndex];
            
            // æ ¹æ®è›‹çš„ç¨€æœ‰åº¦ç­›é€‰å® ç‰©
            const availablePets = gameData.petTypes.filter(pet => pet.rarity === egg.rarity);
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªå® ç‰©
            const randomIndex = Math.floor(Math.random() * availablePets.length);
            const newPet = {...availablePets[randomIndex]};
            newPet.id = Date.now();
            
            // æ·»åŠ åˆ°å® ç‰©èƒŒåŒ…
            gameData.pets.push(newPet);
            
            // ä»è›‹èƒŒåŒ…ç§»é™¤
            gameData.eggs.splice(eggIndex, 1);
            
            // æ˜¾ç¤ºå® ç‰©å¼¹çª—
            showPetPopup(newPet);
            
            // æ›´æ–°UI
            updateUI();
        }
        
        // æ˜¾ç¤ºå® ç‰©å¼¹çª—
        function showPetPopup(pet) {
            elements.popupPetIcon.textContent = pet.icon;
            elements.popupPetName.textContent = pet.name;
            elements.popupPetRarity.textContent = pet.rarity;
            elements.popupPetRarity.className = `rarity ${pet.colorClass}`;
            elements.petPopup.classList.add('show');
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`å­µå‡ºäº†${pet.rarity}å® ç‰©ï¼š${pet.name}ï¼`);
        }
        
        // å‡ºå”®å® ç‰©
        function sellPet(petIndex) {
            const pet = gameData.pets[petIndex];
            const price = gameData.currentMarketPrices[pet.rarity];
            
            // å¢åŠ é‡‘å¸
            gameData.coins += price;
            
            // ç§»é™¤å® ç‰©
            gameData.pets.splice(petIndex, 1);
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`å‡ºå”®äº†${pet.rarity}å® ç‰©${pet.name}ï¼Œè·å¾—${price}é‡‘å¸ï¼`);
            
            // æ›´æ–°UI
            updateUI();
        }
        
        // æŒ‰ç¨€æœ‰åº¦å‡ºå”®æ‰€æœ‰å® ç‰©
        function sellAllPetsByRarity(rarity) {
            const petsToSell = gameData.pets.filter(pet => pet.rarity === rarity);
            const price = gameData.currentMarketPrices[rarity];
            const total = petsToSell.length * price;
            
            if (petsToSell.length === 0) {
                showNotification(`æ²¡æœ‰${rarity}å® ç‰©å¯å‡ºå”®ï¼`);
                return;
            }
            
            // å¢åŠ é‡‘å¸
            gameData.coins += total;
            
            // ç§»é™¤å® ç‰©
            gameData.pets = gameData.pets.filter(pet => pet.rarity !== rarity);
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`å‡ºå”®äº†${petsToSell.length}åª${rarity}å® ç‰©ï¼Œè·å¾—${total}é‡‘å¸ï¼`);
            
            // æ›´æ–°UI
            updateUI();
        }
        
        // è´­ä¹°è›‹
        function buyEgg(rarity) {
            const price = gameData.currentShopPrices[rarity];
            
            // æ£€æŸ¥é‡‘å¸æ˜¯å¦è¶³å¤Ÿ
            if (gameData.coins < price) {
                showNotification('é‡‘å¸ä¸è¶³ï¼');
                return;
            }
            
            // æ‰£é™¤é‡‘å¸
            gameData.coins -= price;
            
            // è·å–è›‹æ•°æ®
            const eggRarity = gameData.eggRarities.find(r => r.name === rarity);
            const newEgg = {
                id: Date.now(),
                name: `${rarity}è›‹`,
                rarity: rarity,
                icon: eggRarity.icon,
                colorClass: eggRarity.colorClass
            };
            
            // æ·»åŠ åˆ°è›‹èƒŒåŒ…
            gameData.eggs.push(newEgg);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            showEggAnimation(newEgg);
            
            // æ›´æ–°UI
            updateUI();
        }
        
        // æ›´æ–°å¸‚åœºä»·æ ¼
        function updateMarketPrices() {
            Object.keys(gameData.marketPrices).forEach(rarity => {
                const range = gameData.marketPrices[rarity];
                gameData.currentMarketPrices[rarity] = 
                    Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
            });
            
            // æ›´æ–°UI
            renderMarket();
        }
        
        // æ›´æ–°å•†åº—ä»·æ ¼
        function updateShopPrices() {
            Object.keys(gameData.shopPrices).forEach(rarity => {
                const range = gameData.shopPrices[rarity];
                gameData.currentShopPrices[rarity] = 
                    Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
            });
            
            // æ›´æ–°UI
            renderShop();
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            elements.notification.textContent = message;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }
        
        // æ ¹æ®ç¨€æœ‰åº¦è·å–é¢œè‰²
        function getRarityColor(rarity) {
            const rarityData = gameData.eggRarities.find(r => r.name === rarity);
            if (rarityData) {
                switch (rarityData.colorClass) {
                    case 'common': return '#8a8a8a';
                    case 'rare': return '#4ea8de';
                    case 'epic': return '#9b5de5';
                    case 'legendary': return '#f15bb5';
                    default: return '#000000';
                }
            }
            return '#000000';
        }
        
        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('petGachaGame', JSON.stringify({
                coins: gameData.coins,
                eggs: gameData.eggs,
                pets: gameData.pets,
                lastClaim: gameData.lastClaim,
                lastMarketUpdate: gameData.lastMarketUpdate,
                lastShopUpdate: gameData.lastShopUpdate,
                currentMarketPrices: gameData.currentMarketPrices,
                currentShopPrices: gameData.currentShopPrices
            }));
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
